<h1 class="header">仪表盘</h1>

<div id="dashboard-container" class="ui two stackable cards">
</div>

<script>
function pageInit(){
    app.setTitle('仪表盘');

    var state = {}
    var modules = {}

    var stateReq = app.get({
        'url': app.adminAPI('/state')
    }).done(function(data, textStatus, jqXHR){
        state = data;
        console.log(state);
        state.lastUpdated = (new Date(data.lastUpdated*1000)).toLocaleString();
    });

    var modulesReq = app.get({
        'url': app.adminAPI('/modules')
    }).done(function(data, textStatus, jqXHR){
        modules = data.modules;
    });

    $.when(stateReq, modulesReq).then(function(){
        app.loadTemplate('#dashboard-container', '#dashboard-template', {
            'state':   state,
            'modules': modules
        });
    });
}
</script>


<script type="x-handler-template" id="dashboard-template">
    <div class="ui card">
        <div class="content left aligned">
            最后更新
            <div class="right floated meta" id="last-updated">{{state.lastUpdated}}</div>
        </div>

        <div class="content left aligned">
            文章
            <div class="right floated meta">{{state.posts}}</div>
        </div>

        <div class="content left aligned">
            已发布
            <div class="right floated meta">{{state.publishedPosts}}</div>
        </div>

        <div class="content left aligned">
            草稿
            <div class="right floated meta">{{state.draftPosts}}</div>
        </div>
    </div>

    <div class="ui card">
        <div class="content left aligned">
            评论
            <div class="right floated meta">{{state.comments}}</div>
        </div>

        <div class="content left aligned">
            已审核
            <div class="right floated meta">{{state.approvedComments}}</div>
        </div>

        <div class="content left aligned">
            待审核
            <div class="right floated meta">{{state.waitingComments}}</div>
        </div>

        <div class="content left aligned">
            垃圾评论
            <div class="right floated meta">{{state.spamComments}}</div>
        </div>
    </div>

    <div class="ui card">
    {{#each modules}}
        <div class="content left aligned">
            {{name}}
            <div class="right floated meta">{{#if isRunning}}运行中...{{else}}停止{{/if}}</div>
        </div>
    {{/each}}
    </div>
</script>
