<div style="text-align:left">
    <h1 class="header">标签管理</h1>

    <div class="ui labels" id="tags"></div>
    <div class="ui divider"></div>
    <div class="ui buttons">
        <button class="ui green button" id="new">新增</button>
        <button class="ui disabled button" id="delete">删除</button>
        <button class="ui disabled button" id="edit">编辑</button>
        <button class="ui disabled button" id="merge">合并</button>
    </div>

</div>


<!-- 删除确认框 -->
<div class="ui modal">
    <i class="close icon"></i>
    <div class="header">确认操作</div>
    <div class="content">
        <div class="description">确认要删除这些标签吗，该操作不可恢复。</div>
    </div>
    <div class="actions">
        <div class="ui cancel green button">取消</div>
        <div class="ui approve red button">确认</div>
    </div>
</div>

<script>
function pageInit() {
    app.setTitle('标签管理');
    loadTags();
    initAction();

    // 加载标签列表
    function loadTags() {
        $('tags').html('');

        app.get({
            'url': app.adminAPI('/tags')
        }).done(function(data, textStatus, jqXHR){
            app.loadTemplate('#tags', '#tags-template', data);
            $('#tags .label').popup();

            $('#tags .label').on('click', function(){
                $(this).toggleClass('blue');
                updateActions();
            });
        });
    } // end loadTags

    // 初始化按钮的操作
    function initAction() {
        $('#new').on('click', function(){
            app.redirect('tags/edit/0');
        });

        $('#delete').on('click', function(){
            $('.ui.modal').modal({
                closable  : false,
                onDeny    : function(){
                },
                onApprove : function() {
                    $('#tags .blue.label').each(function(index, elem){
                        var id = $(elem).attr('data-id');
                        app.delete({
                            'url': app.adminAPI('/tags/'+id)
                        }).done(function(){
                            $(elem).remove();
                            updateActions();
                        });
                    });
                } // end onApprove
            }).modal('show');
        });

        $('#edit').on('click', function(){
            var id = $('#tags .blue.label').attr('data-id');
            app.redirect('tags/edit/'+id);
        });

        $('#merge').on('click', function(){
            //
        });
    }

    // 更新各个按钮的界面。
    function updateActions() {
        var l = $('#tags .blue.label').length;
        switch (l) {
            case 0:
                $('#delete').addClass('disabled').removeClass('red');
                $('#edit').addClass('disabled').removeClass('blue');
                $('#merge').addClass('disabled').removeClass('blue');
                break;
            case 1:
                $('#delete').removeClass('disabled').addClass('red');
                $('#edit').removeClass('disabled').addClass('blue');
                $('#merge').addClass('disabled').removeClass('blue');
                break;
            default:
                $('#delete').removeClass('disabled').addClass('red');
                $('#edit').addClass('disabled').removeClass('blue');
                $('#merge').removeClass('disabled').addClass('blue');
        }
    } // end updateActions
} // end pageInit
</script>

<script id="tags-template" type="x-template-mustache">
    {{#tags}}
    <span class="ui label" style="cursor:pointer"
        data-id="{{id}}"
        data-html="{{description}}">
        {{title}}<span class="detail">{{count}}</span>
    </span>
    {{/tags}}
</script>
