<div style="text-align:left">
    <h1 class="header">分类管理</h1>

    <div id="cats"></div>
    <div class="ui divider"></div>
    <div class="ui buttons">
        <button class="ui green button" id="new">新增</button>
        <button class="ui disabled button" id="delete">删除</button>
        <button class="ui disabled button" id="edit">编辑</button>
        <button class="ui disabled button" id="merge">合并</button>
    </div>

</div>

<script>
function pageInit(){
    app.setTitle('分类管理');
    loadCats();
    initAction();

    function loadCats(){
        app.get({
            'url': app.adminAPI('/cats')
        }).done(function(data, textStatus, jqXHR){
            app.loadTemplate('#cats', '#cats-template', data)
            $('.ui.checkbox').checkbox();

            $('#cats input').on('change', function(){
                updateActions();
            });
        }).fail(function(){
            app.showMessage('red', '加载分类信息失败');
        });
    }

    // 初始化按钮的操作
    function initAction() {
        $('#new').on('click', function(){
            app.redirect('cats/edit/0');
        });

        $('#delete').on('click', function(){
            $('#cats input:checked').each(function(index, elem){
                var id = $(elem).val();
                app.delete({
                    'url': app.adminAPI('/cats/'+id)
                }).fail(function(){
                    app.showMessage('red', '删除'+id+'分类时出错');
                }).done(function(){
                    $(elem).parents('tr').remove();
                    updateActions();
                });
            });
        });

        $('#edit').on('click', function(){
            var id = $('#cats input:checked').val();
            app.redirect('cats/edit/'+id);
        });

        $('#merge').on('click', function(){
            //
        });
    }

    // 更新各个按钮的界面。
    function updateActions() {
        var l = $('#cats input:checked').length;
        switch (l) {
            case 0:
                $('#delete').addClass('disabled').removeClass('red');
                $('#edit').addClass('disabled').removeClass('blue');
                $('#merge').addClass('disabled').removeClass('blue');
                break;
            case 1:
                $('#delete').removeClass('disabled').addClass('red');
                $('#edit').removeClass('disabled').addClass('blue');
                $('#merge').addClass('disabled').removeClass('blue');
                break;
            default:
                $('#delete').removeClass('disabled').addClass('red');
                $('#edit').addClass('disabled').removeClass('blue');
                $('#merge').removeClass('disabled').addClass('blue');
        }
    } // end updateActions
} // end pageInit
</script>

<script id="cats-template" type="x-template-handlebars">
<table class="ui celled table">
    <thead>
        <tr>
            <th>ID</th>
            <th>标题</th>
            <th>名称</th>
            <th>排序</th>
            <th>详细介绍</th>
        </tr>
    </thead>
    <tbody>
    {{#cats}}
        <tr>
            <td>
                <div class="ui checkbox">
                    <label>{{id}}</label>
                    <input type="checkbox" value="{{id}}" />
                </div>
            </td>
            <td>{{title}}</td>
            <td>{{name}}</td>
            <td>{{order}}</td>
            <td>{{description}}</td>
        </tr>
    {{/cats}}
    </tbody>
</table>
</script>
