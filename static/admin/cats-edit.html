<div class="config-div">
    <h1 class="header">编辑分类</h1>
    <form id="cat" class="ui form"></form>
</div>


<script>
function pageInit(id){
    if (id>0) {
        app.setTitle('编辑分类');
        $('h1.header').html('编辑分类');
    }else{
        app.setTitle('添加分类');
        $('h1.header').html('添加分类');
    }

    // 加载数据
    if(id>0) {
        $('.ui.form').addClass('loading');
        app.get({
            'url': app.adminAPI('/cats/'+id)
        }).done(function(data, textStatus, jqXHR){
            app.loadTemplate('#cat', '#cat-template', data)
            initAction();
        }).fail(function(jqXHR, textStatus, errorThrown){
            console.log(errorThrown);
            app.showMessage('red', '无法加载当前被编辑的标签内容！新尝试刷新！');
        }).always(function(){
            $('.ui.form').removeClass('loading');
        });
    }else{
        app.loadTemplate('#cat', '#cat-template', {name:'', title:'', description:''})
        initAction();
    }

    function initAction(){
        $('form').on('submit', function(){
            if (id>0){
                app.put({
                    'url': app.adminAPI('/cats/'+id),
                    'data':app.buildJSON($('.ui.form'))
                }).done(function(){
                    app.redirect('/cats/list');
                }).fail(function(){
                    app.showMessage('red', '提交数据失败');
                });
            }else{
                app.post({
                    'url': app.adminAPI('/cats'),
                    'data':app.buildJSON($('.ui.form'))
                }).done(function(){
                    app.redirect('/cats/list');
                }).fail(function(jqXHR, textStatus, errorThrown){
                    app.showMessage('red', '提交数据失败'+errorThrown);
                });
            }

            return false;
        });
    }
} // end pageInit
</script>


<script id="cat-template" type="x-handlebars-template">
    <div class="field">
        <label>唯一名称，可为空</label>
        <input type="text" name="name" value="{{name}}" />
    </div>

    <div class="field">
        <label>字面文字</label>
        <input type="text" name="title" value="{{title}}" required="required" />
    </div>

    <div class="field">
        <label>排序，小数字排在前</label>
        <input type="number" name="order" min="0" value="{{order}}" required="required" />
    </div>

    <div class="field">
        <label>描述内容</label>
        <textarea name="description" required="required">{{description}}</textarea>
    </div>

    <div class="field">
        <button class="ui primary fluid button" type="submit">提交</button>
    </div>
</script>
