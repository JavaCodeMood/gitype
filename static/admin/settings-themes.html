<div style="text-align:left">
    <style>
    .ui.segment{
        width:23em;
        display:inline-block;
        margin-left:3em;
    }
    .ui.segment .label{
        cursor:pointer;
    }
    .ui.segment img{
        width:290px;
        height:160px;
    }
    </style>
    <h1 class="header">选择主题</h1>
    <div id="themes"></div>
</div>

<script>
function pageInit(){
    app.setTitle('选择主题');

    var getThemes = app.get({
        'url': app.adminAPI('/themes')
    }).done(function(data, textStatus, jqXHR){
        app.loadTemplate($('#themes'), $('#themes-template'), data)
    }).fail(function(){
        app.showMessage('red', '加载主题列表失败');
    });

    var getCurrTheme = app.get({
        'url': app.adminAPI('/themes/current')
    }).done(function(data, textStatus, jqXHR){
        updateActivedTheme(data.theme);
    }).fail(function(){
        app.showMessage('red', '获取当前主题信息失败');
    });

    $.when(getThemes, getCurrTheme).then(function(){
        $('.ui.segment .label').on('click', function(){
            var theme = $(this).attr('data-key');
            app.put({
                'url': app.adminAPI('/themes/current'),
                'data':JSON.stringify({value:theme})
            }).done(function(){
                updateActivedTheme(theme);
                app.showMessage('green', '将主题切换到'+theme);
            }).fail(function(){
                app.showMessage('red', '更新主题失败');
            });
        });
    });
}

function updateActivedTheme(name) {
    $('#themes .segment .ribbon.label').removeClass('teal');
    $('#themes .segment .ribbon.label[data-key='+name+']').addClass('teal');
}
</script>

<script id="themes-template" type="x-mustache-template">
{{#each themes}}
<div class="ui segment">
    <span data-key="{{@key}}" class="ui ribbon label">{{name}}</span><span>{{description}}</span>
    <div class="image">
        <img src="{{screenshot}}" alt="screenshoot" />
    </div>

    {{#author}}
    <div class="ui divider"></div>
    <div class="extra content">
        <span><i class="user icon"></i>{{name}}</span>
        {{#if email}}<a style="float:right" href="mailto:{{email}}" title="作者邮箱"><i class="send icon"></i></a>{{/if}}
        {{#if url}}<a style="float:right" href="{{url}}" title="作者网站"><i class="linkify icon"></i></a>{{/if}}
    </div>
    {{/author}}
</div>
{{/each}}
</script>
