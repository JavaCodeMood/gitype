<div style="text-align:left">
    <h1 class="header">媒体文件</h1>

    <div id="media-list"></div>

    <div class="ui divider"></div>

</div>

<script>
function pageInit(){
    loadFiles('/');

    function loadFiles(path){
        app.get({
            'url': app.adminAPI('/media?parent=')+path
        }).done(function(data, textStatus, jqXHR){
            $('#media-list').html('');
            for (var i = 0; i < data.list.length; i++) { // 转换图标
                data.list[i].path = path + '/' + data.list[i].name;
                switch (data.list[i].type) {
                    case 'image':
                        var url = app.uploadURL(data.list[i].path);
                        data.list[i].image = '<img style="max-width:15em;max-height:20em" src="' + url + '" />';
                        data.list[i].icon = 'file image outline';
                        break;
                    case 'dir':
                        data.list[i].icon = 'folder';
                        break;
                    default:
                        data.list[i].icon = 'file';
                        break;
                }
            }

            console.log(path);
            var dirs = path.split('/');
            data.breadcrumb = [];
            var bcpath = '';
            for (var i = 0; i < dirs.length; i++) {
                if (dirs[i].length == 0){
                    dirs[i] = '/';
                }
                bcpath += dirs[i];
                var obj = {
                    name: dirs[i],
                    path: bcpath
                }
                data.breadcrumb.push(obj);
            } // end for
            app.loadTemplate('#media-list', '#media-template', data);
            $('#media-list a.item[data-html]').popup();
            initActions();
        }); // end app.get
    } // end loadFiles

    function initActions(){
        $('#media-list .ui.list .item').on('click', function(){
            var path = $(this).attr('data-path');
            loadFiles(path);
        });

        $('.breadcrumb .section').on('click', function(){
            var path = $(this).attr('data-path');
            loadFiles(path);
        });
    }
}
</script>

<script type="x-handler-template" id="media-template">
    <div class="ui small breadcrumb">
        {{#each breadcrumb}}
        <span class="section" data-path="{{path}}">{{name}}</span>
        <i class="right chevron icon divider"></i>
        {{/each}}
    </div>

    <div class="ui list">
    {{#each list}}
        <a class="item" data-path="{{path}}" {{#if image}} data-html="{{image}}"{{/if}}>
            <span class="ui image"><i class="{{icon}} icon"></i></span>
            <div class="content">{{name}}</div>
        </a>
    {{/each}}
    </div>
</script>
