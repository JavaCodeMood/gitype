<h1 class="header">媒体文件</h1>

<div id="media-list">
</div>

<script>
function pageInit(){
    loadFiles('/');

    function loadFiles(path){
        app.get({
            'url': app.adminAPI('/media?parent=')+path
        }).done(function(data, textStatus, jqXHR){
            $('#media-list').html('');
            for (var i = 0; i < data.list.length; i++) { // 转换图标
                switch (data.list[i].type) {
                    case 'image':
                        var url = app.uploadURL(path + '/' + data.list[i].name);
                        data.list[i].image = '<img style="max-width:15em;max-height:20em" src="' + url + '" />';
                        data.list[i].icon = 'file image outline';
                        break;
                    case 'dir':
                        data.list[i].icon = 'folder';
                        break;
                    default:
                        data.list[i].icon = 'file';
                        break;
                }
            }
            app.loadTemplate('#media-list', '#media-template', data);
            $('#media-list a.item[data-html]').popup();
            initActions(path);
        }); // end app.get
    } // end loadFiles

    function initActions(parent){
        $('#media-list .ui.list .item').on('click', function(){
            var path = $(this).attr('data-path');
            path = parent + '/' + path;
            loadFiles(path);
        });
    }
}
</script>

<script type="x-handler-template" id="media-template">
    <div class="ui list">
    {{#each list}}
        <a class="item" data-path="{{name}}" {{#if image}} data-html="{{image}}"{{/if}}>
            <span class="ui image"><i class="{{icon}} icon"></i></span>
            <div class="content">{{name}}</div>
        </a>
    {{/each}}
    </div>
</script>
