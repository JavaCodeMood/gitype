<div style="width:35em;margin:auto;text-align:left">
    <h1 class="header">系统设置</h1>
    <form class="ui form">
        <div class="field">
            <label for="siteName">网站名称</label>
            <input id="siteName" type="text" value="" />
        </div>

        <div class="field">
            <label for="siteURL">网站地址</label>
            <input id="siteURL" type="url" value="" />
            <div class="description">网站根地址，必须以<strong>http://</strong>或<strong>https://</strong>开头！</div>
        </div>

        <div class="field">
            <label for="pageSize">每页显示数量</label>
            <input id="pageSize" type="number" min="1" max="100" value="" />
            <div class="description">每页显示的记录数量！<br />取值范围(0-100]</div>
        </div>

        <div class="field">
            <label for="keywords">Keywords</label>
            <input id="keywords" type="text" value="" />
            <div class="description">页面的默认keywords</div>
        </div>

        <div class="field">
            <label for="description">Description</label>
            <input id="description" type="text" value="" />
            <div class="description">页面的默认description</div>
        </div>
    </form>
</div>

<script>
function getData(id){
    get({
        'url': '/admin/api/options/'+id
    }).done(function(data, textStatus, jqXHR){
        $('#'+id).val(data.value);
        $('#'+id).attr('data-default', data.value);
    }).fail(function(){
        showMessage('red', '加载'+id+'资源失败');
    });
}

function patchData(id) {
    $('#'+id).on('blur', function(){
        var elem = $('#'+id)
        if (elem.attr('data-default') == elem.val()) {
            return
        }

        patch({
            'url': '/admin/api/options/'+id,
            'data':JSON.stringify({"value": elem.val()})
        }).done(function(){
            elem.attr('data-default', elem.val());
            showMessage('green', '设置已经保存');
        }).fail(function(){
            elem.val(elem.attr('data-default'));
            showMessage('red', '更新'+id+'资源失败');
        });
    });
}
$(document).ready(function(){
    setTitle('系统设置');
    $('.ui.checkbox').checkbox();

    /* BEGIN -- 加载数据 */
    $('form').addClass('loading');

    var siteName    = getData('siteName');
    var siteURL     = getData('siteURL');
    var pageSize    = getData('pageSize');
    var keywords    = getData('keywords');
    var description = getData('description');
    $.when(siteName, siteURL, pageSize, keywords, description).always(function(){
        $('form').removeClass('loading');
    });
    /* END -- 加载数据 */

    /* BEGIN -- patch */
    patchData('siteName')
    patchData('siteURL')
    patchData('pageSize')
    patchData('keywords')
    patchData('description')
    /* END -- patch */
});
</script>
